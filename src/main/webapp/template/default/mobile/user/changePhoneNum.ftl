<#import "/common/app.ftl" as app> <#include "/common/common.ftl" /><!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="Content-Language" content="zh-CN"><meta name="keywords" content=""><meta name="description" content=""><meta name="copyright" content="" /><meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><title>修改手机号</title><!-- css --><link href="${app.basePath}/static/touch/css/common.css" rel="stylesheet" type="text/css" /><link href="${app.basePath}/static/touch/css/main.css" rel="stylesheet" type="text/css" /><link href="${app.basePath}/static/touch/css/x_pc.css" rel="stylesheet" type="text/css" /><link href="${app.basePath}/static/touch/css/index.css" rel="stylesheet" type="text/css" /><!-- js --><script type="text/javascript" src="${app.basePath}/static/touch/js/jquery-1.9.1.min.js"></script><script type="text/javascript" src="${app.basePath}/static/js/Validform_v5.3.2_min.js"></script><script type="text/javascript" src="${app.basePath}/static/touch/js/common.js"></script><script src="${app.basePath}/static/js/mobile/user/user.js" type="text/javascript"></script><style type="text/css">.regionslec select{ padding:10px 3px; margin:10px 1px;}</style></head><body class="body_gray">  <!-- header_top -->  <div class="top_heater">    <a href="${app.basePath}/mobile/user/center" title="返回个人中心" class="hleft hback"></a>    <span>修改手机号</span>  </div>  <!-- header_top end -->  <!-- Center Start -->  <section class="container change-password">    <form id="changePhoneNumForm" action="${app.basePath}/mobile/user/savePhoneNum">      <div class="inpt">        <label>新手机号</label>        <input type="text" id="utel" name="utel" placeholder="请输入新手机号" datatype="m" nullmsg="请填写新手机号！" errormsg="手机号码格式错误！">      </div>      <div class="get-code">        <label>图形验证码</label>        <input type="text" id="verifyCode" datatype="*" nullmsg="请填写验证码！">        <a href="#"><img src="${app.basePath}/authImage" style="width:129;height:47;" onclick="fushVerifyCode()" id="getVerifyCode"></a>      </div>      <div class="get-code">        <label>验证码</label>        <input type="text" name="valideCode" id="valideCode" datatype="*" nullmsg="请填写验证码！">        <a href="javascript:;" id="getChangePhoneNumValidCode" title="获取验证码">获取验证码</a>      </div>      <div class="regionslec">      	<label id="firstLevelDistrict">        </label>        <label id="secondLevelDistrict">        </label>        <label id="thirdLevelDistrict">        </label>      </div>      <input type="hidden" id="uregionId" name="uregionId" value="<#if uregionId??>${uregionId?c}</#if>">  </section>  <!-- Center End -->  <div class="clear" style="width:100%;height:.8rem;"></div>  <a class="btn-now-withdraw" id="goChangePhoneNum" href="javascript:;" title="提交修改">提交修改</a>  </form>  <input type="hidden" id="levelCount" value="${levelCount!'-1' }">  <input type="hidden" id="disIdStr" value="${disIdStr!'' }"></body><script>	$(document).ready(function(){		// 初始化加载第一级地区		initUserRegion();		// 初始化ValidForm插件		$("#changePhoneNumForm").Validform({			tiptype:function(msg,o,cssctl){			    //msg：提示信息;			    //o:{obj:*,type:*,curform:*},			    //obj指向的是当前验证的表单元素（或表单对象，验证全部验证通过，提交表单时o.obj为该表单对象），			    //type指示提示的状态，值为1、2、3、4， 1：正在检测/提交数据，2：通过验证，3：验证失败，4：提示ignore状态, 			    //curform为当前form对象;			    //cssctl:内置的提示信息样式控制函数，该函数需传入两个参数：显示提示信息的对象 和 当前提示的状态（既形参o中的type）;			    if(o.type == 3){			    	alert(msg);			    }			},			postonce:true, // 开启二次提交防御			ajaxPost:true, 			callback:function(data){				//返回数据data是json对象，{"info":"demo info","status":"y"}				//info: 输出提示信息;				//status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在ajax_post.php文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;				alert(data.info);				if(data.status == 'y'){					window.location.href = basePath+"/mobile/user/info";				}			}		});				// 为提交按钮绑定事件		$("#goChangePhoneNum").bind("click", function(){			var sd = getSelectedDistrict();			if(sd == -1){				alert("未选中地区");				return;			}else{				$("#uregionId").val(sd);		  		$("#changePhoneNumForm").submit();			}		});		// 为获取验证按钮绑定获取验证码事件		$("#getChangePhoneNumValidCode").bind("click", function(){			var vurl = basePath+"/mobile/user/verifyCode";			var vcode =	$("#verifyCode").val();			if(vcode == ""){				alert("请输入图形验证码");				return;			}			var vdata = {'vcode': vcode};			$.post(vurl, vdata, function(data){				var jdata = eval('('+data+')');				if(jdata.code == 0){					alert(jdata.msg);					return;				}else{					var phone = $("#utel").val();					if(phone == ""){						alert("请输入手机号码。");						return;					}else if(!(/^1[3|4|5|7|8]\d{9}$/.test(phone))){ 						alert("手机号码有误，请重填");						return;					}else{						pisWait = true;						waitSecondsForPhoneNum($("#getChangePhoneNumValidCode"));						var url = basePath+"/mobile/user/getChangePhoneNumValidCode";						var loadData = {'phone': phone};						$.post(url, loadData, function(pdata){							var result = eval("("+pdata+")");							alert('消息提醒'+result.msg);							pisWait = false;						}, "text");								}				}			}, "text");					});		// 为获取验证按钮绑定等待60秒事件		$("#getChangePhoneNumValidCode").bind("click", function(){			if(pisWait){				waitSecondsForPhoneNum($("#getChangePhoneNumValidCode"));			}		});	});			// 地区加载	function loadDistrictSelections(parentId, liId, selectedId){		var url = basePath+"/mobile/user/getDistrictSelections";		var nextLiId = nextLi(liId);		if(nextLiId != "nothing"){			$("#" + nextLiId).html("");		}		var nnextLiId = nextLi(nextLiId);		if(nnextLiId != "nothing"){			$("#" + nnextLiId).html("");		}		var loadData = {"parentId": parentId, "nextLiId": nextLiId, "selectedId": selectedId};		$.post(url, loadData, function(template){    		$("#"+liId).html(template);    	}, "text");	}		// 获取所选地区的下一级地区下拉框	function getNextLevelDistrcitSelections(parentId, liId, canGetNextDistrictSelections){		if(canGetNextDistrictSelections == "false"){			return;		}else{			loadDistrictSelections(parentId, liId, '-1');				}	}		// 下一级地区liId	function nextLi(currentLi){		if(currentLi=="firstLevelDistrict"){			return "secondLevelDistrict";		}		if(currentLi=="secondLevelDistrict"){			return "thirdLevelDistrict";		}		if(currentLi=="thirdLevelDistrict"){			return "nothing";		}	}		// 获取选择的地区id，若没选中则返回-1	function getSelectedDistrict(){		var firstSelect = $("#firstLevelDistrict").find("select");		var secondSelect = $("#secondLevelDistrict").find("select");		var thirdSelect = $("#thirdLevelDistrict").find("select");		var firstOption = "-1";		var secondOption = "-1";		var thirdOption = "-1";		if(firstSelect.length != 0){			firstOption = $("#firstLevelDistrict").find("select").val();		}		if(secondSelect.length != 0){			secondOption = $("#secondLevelDistrict").find("select").val();		}		if(thirdSelect.length != 0){			thirdOption = $("#thirdLevelDistrict").find("select").val();		}		if(thirdOption != "-1"){			return thirdOption;		}else if(secondOption != "-1"){			var firstSelectName = $("#firstLevelDistrict").find("select").find("option:selected").text();			if(isCentralCity(firstSelectName)){				return secondOption;			}		}else if(firstOption != "-1"){			var firstSelectName = $("#firstLevelDistrict").find("select").find("option:selected").text();			return firstOption;		}		return "-1";	}		//是否是直辖市	function isCentralCity(districtName){		if(districtName.indexOf("北京")>=0 || districtName.indexOf("天津")>=0 || districtName.indexOf("上海")>=0 || districtName.indexOf("重庆")>=0){			return true;		}else{			return false;		}	}		// select动态选择	function dynamicSelect(id, value){		$("#" + id).find("option[value="+value+"]").prop("selected",true);		$("#" + id).change();	}		// 初始化地区加载	function initUserRegion(){		var levelCount = $("#levelCount").val();		var disIdStr = $("#disIdStr").val();		if(levelCount == -1){			return;		}else{			var disIdArray = disIdStr.split(",");			if(levelCount == 1){				loadDistrictSelections(disIdArray[0], 'firstLevelDistrict', disIdArray[1]);			}else if(levelCount == 2){				loadDistrictSelections(disIdArray[0], 'firstLevelDistrict', disIdArray[1]);				loadDistrictSelections(disIdArray[1], 'secondLevelDistrict', disIdArray[2]);			}else{				loadDistrictSelections(disIdArray[0], 'firstLevelDistrict', disIdArray[1]);				loadDistrictSelections(disIdArray[1], 'secondLevelDistrict', disIdArray[2]);				loadDistrictSelections(disIdArray[2], 'thirdLevelDistrict', disIdArray[3]);			}		}	}		//刷新图形验证码src	function fushVerifyCode(){		var src = $("#getVerifyCode").attr("src");		var rnum = getRandom(99999);		$("#getVerifyCode").attr("src", src + "?rnum=" + rnum);	}	//产生随机数	function getRandom(n){    	return Math.floor(Math.random()*n+1)    }</script></html>