<#import "/common/app.ftl" as app> <!DOCTYPE html><html lang="en"><head>	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />    <meta http-equiv="Content-Language" content="zh-CN">    <meta name="keywords" content="${system.webkeywords!''}">    <meta name="description" content="${system.webkeywords!''}">    <meta name="copyright" content="${system.webkeywords!''}" />    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">    <meta content="yes" name="apple-mobile-web-app-capable">    <meta content="black" name="apple-mobile-web-app-status-bar-style">    <meta content="telephone=no" name="format-detection">    <link rel="shortcut icon" href="${app.basePath}/static/default/images/icon.ico" />    <title>修改手机号-  ${system.webkeywords!''}</title>    <!-- css -->    <link rel="stylesheet" href="${app.basePath}/static/default/client/style/site.css" type="text/css"/>    <link rel="stylesheet" type="text/css" href="${app.basePath}/static/default/client/style/personal-center-common.css">    <link rel="stylesheet" type="text/css" href="${app.basePath}/static/default/client/style/f_personal_center.css">    <link rel="stylesheet" type="text/css" href="${app.basePath}/static/default/client/style/lhead.css">    <link rel="stylesheet" type="text/css" href="${app.basePath}/static/default/client/style/index.css">    <link rel="stylesheet" type="text/css" href="${app.basePath}/static/default/client/style/has.css">    <!-- js -->    <#include "/common/common.ftl" />    <script type="text/javascript" src="${app.basePath}/static/js/jquery-1.12.3.min.js"></script>	<script type="text/javascript" src="${app.basePath}/static/js/client/html5.js"></script>	<script type="text/javascript" src="${app.basePath}/static/js/client/library.js"></script>	<script type="text/javascript" src="${app.basePath}/static/js/client/user/user.js"></script>	<script type="text/javascript" src="${app.basePath}/static/js/client/user/jquery.cityselect.js"></script>	<!--通用js-->    <script type="text/javascript" src="${app.basePath}/static/js/client/core.js"></script>    <script type="text/javascript" src="${app.basePath}/static/js/client/common.js"></script>    <script type="text/javascript" src="${app.basePath}/static/js/Validform_v5.3.2_min.js"></script></head><body><h1 style="display:none;"></h1><!-- header_top --><#include "../common/centerheader.ftl"><!-- header_top end --><div class="clear"></div><!-- Center Start --><!-- Center Start --><div class="index-main">    <div class="personal-center">        <!-- 左侧导航 -->        <#include "../common/centerleftmenu.ftl">         <!-- 右侧内容 -->    	<div class="change_password modify_personal">            <form id="changePhoneNumForm" method="post" action="${app.basePath}/user/savePhoneNum">              <div class="h2">修改手机号</div>              <div class="info-list">                <label><span>*</span>手机号</label>                <input type="text" id="utel" name="utel" placeholder="请输入新手机号" datatype="m" nullmsg="请填写新手机号！" errormsg="手机号码格式错误！">              </div>              <div class="info-list">                <label><span>*</span>图形验证码</label>		        <input type="text" id="verifyCode" datatype="*" nullmsg="请填写验证码！">		        <a href="#"><img src="${app.basePath}/authImage" style="width:129;height:47;" onclick="fushVerifyCode()" id="getVerifyCode"></a>              </div>              <div class="info-list">                <label>短信验证码</label>		        <input type="text" name="valideCode" id="valideCode" datatype="*" nullmsg="请填写验证码！">		        <a href="javascript:;" id="getChangePhoneNumValidCode" title="获取验证码">获取验证码</a>              </div>              <div class="info-list" id="address">                  <label>注册地址</label>	              <select id="prov" name="uprovinceId" class="prov"></select>				  <select id="city" name="ucityId" class="city"></select>				  <select id="dist" name="uregionId" class="dist"></select>              </div>              <input class="btn-ok-modify" type="submit" value="确认修改" />            </form>        </div>        <!-- 右侧内容 END -->    </div>    <div class="clear"></div></div><!-- Center End --><script>	$(function(){		$("#address").citySelect({	          nodata:"none",	          <#if province??>prov: "${province!''}",</#if>	          <#if city??>city: "${city!''}",</#if>	          <#if district??>dist: "${district!''}",</#if>	          required:false	      });		$("#changePhoneNumForm").Validform({			tiptype:function(msg,o,cssctl){			    //msg：提示信息;			    //o:{obj:*,type:*,curform:*},			    //obj指向的是当前验证的表单元素（或表单对象，验证全部验证通过，提交表单时o.obj为该表单对象），			    //type指示提示的状态，值为1、2、3、4， 1：正在检测/提交数据，2：通过验证，3：验证失败，4：提示ignore状态, 			    //curform为当前form对象;			    //cssctl:内置的提示信息样式控制函数，该函数需传入两个参数：显示提示信息的对象 和 当前提示的状态（既形参o中的type）;			    if(o.type == 3){			    	alert(msg);			    }			},			beforeSubmit:function(curform){			 	//验证注册地址			 	var provinceId = $("#prov").val();				var cityId = $("#city").val();				var districtId= $("#dist").val();				var district= $("#dist").find("option:selected").text();				district = district==undefined ? "": district;				var province = $("#prov").find("option:selected").text();				var city = $("#city").find("option:selected").text();				var districtChildNo = $("#dist").children().length;				var regionId = districtChildNo > 1 ? districtId:cityId;			 	if(TdIsNull(provinceId) || TdIsNull(cityId) ||(districtChildNo > 1 && TdIsNull(districtId))){			 		alert("请填写注册地址！");			 		return false;			 	}			 	openwaiting();			},			postonce:true, // 开启二次提交防御			ajaxPost:true, 			callback:function(data){				alert(data.msg);				if(data.code == 1){					window.location.href=basePath+"/user/center";									}			}		});		// 为提交按钮绑定事件		$("#goChangePhoneNum").bind("click", function(){			var sd = getSelectedDistrict();			if(sd == -1){				alert("未选中地区");				return;			}else{				$("#uregionId").val(sd);		  		$("#changePhoneNumForm").submit();			}		});		// 为获取验证按钮绑定获取验证码事件		$("#getChangePhoneNumValidCode").bind("click", function(){			var vurl = basePath+"/mobile/user/verifyCode";			var vcode =	$("#verifyCode").val();			if(vcode == ""){				alert("请输入图形验证码");				return;			}			var vdata = {'vcode': vcode};			$.post(vurl, vdata, function(data){				var jdata = eval('('+data+')');				if(jdata.code == 0){					alert(jdata.msg);					return;				}else{					var phone = $("#utel").val();					if(phone == ""){						alert("请输入手机号码。");						return;					}else if(!(/^1[3|4|5|7|8]\d{9}$/.test(phone))){ 						alert("手机号码有误，请重填");						return;					}else{						pisWait = true;						waitSecondsForPhoneNum($("#getChangePhoneNumValidCode"));						var url = basePath+"/mobile/user/getChangePhoneNumValidCode";						var loadData = {'phone': phone};						$.post(url, loadData, function(pdata){							var result = eval("("+pdata+")");							alert('消息提醒'+result.msg);							pisWait = false;						}, "text");								}				}			}, "text");					});		// 为获取验证按钮绑定等待60秒事件		$("#getChangePhoneNumValidCode").bind("click", function(){			if(pisWait){				waitSecondsForPhoneNum($("#getChangePhoneNumValidCode"));			}		});	});			function TdIsNull(object)	{		if(null==object||"" == object)		{			return true;		}		return false;	}		//刷新图形验证码src	function fushVerifyCode(){		var src = $("#getVerifyCode").attr("src");		var rnum = getRandom(99999);		$("#getVerifyCode").attr("src", src + "?rnum=" + rnum);	}	//产生随机数	function getRandom(n){    	return Math.floor(Math.random()*n+1)    }</script><!-- Footer Start --><#include "../common/commonfooter.ftl"><!-- Footer End --></body></html>