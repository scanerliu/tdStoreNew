<#import "/common/app.ftl" as app> <!-- 全国代理、商品编辑 --><form id="productForm" class="all_nation white_box" style="padding-bottom:40px;" method="post" action="${app.basePath}/user/saveproductprice">    <div class="otitle">        <label for="" class="lab1 fl">价格编辑</label>    </div>    <div class="tabb obody">    	<input type="hidden" name="id" value="${tdProduct.id!''}">    	<div class="fig fig1">            <label for="" class="lab1 fl">商品编号:</label>            <label class="lab1 fl">${tdProduct.code!''}</label>        </div>    	<div class="fig fig1">            <label for="" class="lab1 fl">商品名称:</label>            <label class="lab1 fl">${tdProduct.name!''}</label>        </div>    	<div class="fig fig1">            <label for="" class="lab1 fl">运费:</label>            <label class="lab1 fl">${tdProduct.postage!'0'}</label>        </div>        <div class="fig fig3">            <table class="table1" id="skuTable">                <tr style="background:#ddd;">                    <td>规格值</td>                    <td>货品编号</td>                    <td>供应商价</td>                    <td>零售价</td>                    <td>市场价</td>                    <td>最高价</td>                    <td>最低价</td>                    <td>商品库存</td>                </tr>                <#if productSkuList??>                	<#list productSkuList as sku>                		<tr tid="${sku.specKey!''}" class="skuspec">		                    <td>${sku.specOptionsKey!''}</td>		                    <td>${sku.skuCode!''}</td>		                    <td>${sku.supplierPrice!'0'}</td>		                    <td><input type="text" min="${sku.lowPrice!'0'}" high="${sku.highPrice!'0'}" class="salesprice" name="skuList[${sku_index}].salesPrice" value="${sku.salesPrice!'0'}" <#if tdProduct.kind?? && tdProduct.kind==3>readonly="readonly" </#if> datatype="/(^[1-9]\d{0,7}(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/i" nullmsg="请填写零售价！" errormsg="零售价格式错误！"></td>		                    <td>${sku.marketPrice!'0'}</td>		                    <td>${sku.highPrice!'0'}</td>		                    <td>${sku.lowPrice!'0'}</td>		                    <td>${sku.stock!'0'}</td>		                    <input type="hidden" name="skuList[${sku_index}].id" value="${sku.id!''}">		                </tr>                	</#list>                </#if>            </table>        </div>    </div>    <div class="sub_div" style="padding:0 80px;">    	<input type="submit" value="确认提交" class="btn" style="width:146px; height:40px;border-radius:0;">    	<input type="button" value="取消" class="btn" onclick="returnList()" style="width:146px; height:40px;border-radius:0;">    </div></form><script>$(function(){	$("#productForm").Validform({		tiptype:function(msg,o,cssctl){		    //msg：提示信息;		    //o:{obj:*,type:*,curform:*},		    //obj指向的是当前验证的表单元素（或表单对象，验证全部验证通过，提交表单时o.obj为该表单对象），		    //type指示提示的状态，值为1、2、3、4， 1：正在检测/提交数据，2：通过验证，3：验证失败，4：提示ignore状态, 		    //curform为当前form对象;		    //cssctl:内置的提示信息样式控制函数，该函数需传入两个参数：显示提示信息的对象 和 当前提示的状态（既形参o中的type）;		    if(o.type == 3){		    	alert(msg);		    }		},		beforeCheck:function(curform){		},		beforeSubmit:function(curform){			//验证价格合法			var flag = true;			$("#skuTable .salesprice").each(function(){				var obj = $(this);				var price = obj.val()*1;				var maxprice = obj.attr("high")*1;				var min = obj.attr("min")*1;				if(price>maxprice || price < min){					flag = false;					return;				}			});			if(!flag){				alert("销售价设置有误：不能大于最高价且不能低于最低价！");				return false;			}			openwaiting();		},		postonce:true, // 开启二次提交防御		ajaxPost:true, 		callback:function(data){			//返回数据data是json对象，{"msg":"demo info","code":"1"}			//info: 输出提示信息;			//status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在ajax_post.php文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;			closewaiting();			alert(data.msg);			if(data.code == 1){				returnList();				refreshList();			}		}	});});</script>